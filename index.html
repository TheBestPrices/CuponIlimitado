<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Raspa y gana</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    body {
      background: #ffeef4;
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
    }
    #container {
      position: relative;
      width: 300px;
      height: 200px;
      margin: 0 auto;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      border: 2px solid #e91e63;
      cursor: crosshair;
    }
    #hiddenLayer {
      z-index: 1;
    }
    #coverLayer {
      z-index: 2;
    }
    #mensajeFinal {
      margin-top: 30px;
      opacity: 0;
      transition: opacity 2s ease;
      font-family: 'Great Vibes', cursive;
      font-size: 20px;
      max-width: 320px;
      margin-left: auto;
      margin-right: auto;
      color: #d81b60;
      position: relative;
    }
    .flechitas {
      font-size: 24px;
      animation: flotando 2s infinite alternate ease-in-out;
      color: #d81b60;
    }

    @keyframes flotando {
      0% { transform: translateY(0px); }
      100% { transform: translateY(-6px); }
    }
  </style>
</head>
<body>

  <h2>🎉 Raspa para descubrir tu regalo 🎉</h2>

  <div id="container">
    <canvas id="hiddenLayer" width="300" height="200"></canvas>
    <canvas id="coverLayer" width="300" height="200"></canvas>
  </div>

  <div id="mensajeFinal">
    <div class="flechitas">❤️‍🔥 ❤️‍🔥</div>
    <em>“No sé cómo vas a reaccionar... y está bien. Lo que sí sé es que quiero ofrecerte este gesto sin expectativas, pero con todo lo que siento. Si alguna parte de tu corazón sonríe al verlo, eso ya vale todo.”</em>
    <div class="flechitas">❤️‍🔥 ❤️‍🔥</div>
  </div>

  <script>
    const hiddenCanvas = document.getElementById('hiddenLayer');
    const hiddenCtx = hiddenCanvas.getContext('2d');

    const coverCanvas = document.getElementById('coverLayer');
    const coverCtx = coverCanvas.getContext('2d');

    const mensajeFinal = document.getElementById('mensajeFinal');

    hiddenCtx.fillStyle = "#fff";
    hiddenCtx.fillRect(0, 0, hiddenCanvas.width, hiddenCanvas.height);
    hiddenCtx.font = "18px Arial";
    hiddenCtx.fillStyle = "#d81b60";
    hiddenCtx.textAlign = "center";
    hiddenCtx.fillText("🎁 Cupón gratis ilimitado 🎁", hiddenCanvas.width / 2, 90);
    hiddenCtx.fillStyle = "#25D366";
    hiddenCtx.fillRect(100, 110, 100, 35);
    hiddenCtx.fillStyle = "#fff";
    hiddenCtx.font = "15px Arial";
    hiddenCtx.fillText("Canjear", hiddenCanvas.width / 2, 133);

    coverCanvas.addEventListener("click", (e) => {
      const rect = coverCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      if (x > 100 && x < 200 && y > 110 && y < 145) {
        window.open("https://wa.me/50589679892?text=Cupon%20de%20besos%20y%20abrazos.%20T%C3%BA%20decides%20si%20canjearlo%20ahorita%20o%20cuando%20lo%20desees.%20Es%20ilimitado%20💌", "_blank");
      }
    });

    let totalPixels = 300 * 200;
    coverCtx.fillStyle = "#999";
    coverCtx.fillRect(0, 0, coverCanvas.width, coverCanvas.height);

    coverCanvas.addEventListener("mousemove", function(e) {
      if (e.buttons !== 1) return;
      const rect = coverCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      coverCtx.globalCompositeOperation = "destination-out";
      coverCtx.beginPath();
      coverCtx.arc(x, y, 15, 0, Math.PI * 2);
      coverCtx.fill();

      const pixels = coverCtx.getImageData(0, 0, 300, 200).data;
      let clearCount = 0;
      for (let i = 0; i < pixels.length; i += 4) {
        if (pixels[i + 3] === 0) {
          clearCount++;
        }
      }
      let porcentaje = clearCount / totalPixels;
      if (porcentaje > 0.2) {
        mensajeFinal.style.opacity = 1;
      }
    });
  </script>

</body>
</html>